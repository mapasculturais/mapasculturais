[![Join the chat at https://t.me/joinchat/WCYOkiRbAWmxQM2y](https://patrolavia.github.io/telegram-badge/chat.png)](https://t.me/joinchat/WCYOkiRbAWmxQM2y)

# Mapas Culturais

Em julho de 2013, agentes culturais de vários países da América Latina e do Brasil se reuniram para discutir a criação de uma ferramenta de mapeamento de iniciativas culturais e gestão cultural. Desse encontro surgiram as bases para a criação de Mapas Culturais, um software livre que permite o aprimoramento da gestão cultural dos municípios e estados.

Mapas Culturais é uma plataforma colaborativa que reúne informações sobre agentes, espaços, eventos e projetos culturais, fornecendo ao poder público uma radiografia da área de cultura e ao cidadão um mapa de espaços e eventos culturais da região. A plataforma está alinhada ao Sistema Nacional de Informação e Indicadores Culturais do Ministério da Cultura (SNIIC) e contribui para a realização de alguns dos objetivos do Plano Nacional de Cultura.

A plataforma já está em uso em diversos municipios, estados, no governo federal em diversos projetos do ministério da cultura e até mesmo fora do Brasil no Uruguai. Instalações recentes: 


### Instalações em nível federal ou internacional
- IberculturaViva - https://mapa.iberculturaviva.org/
- Mapa Uruguai - https://culturaenlinea.uy/
- SNIIC - https://mapa.cultura.gov.br/
- Cultura Viva - https://culturaviva.cultura.gov.br/
- Rede das Artes - https://rededasartes.cultura.gov.br/

### Instalações estaduais
- Amapá - https://mapacultural.ap.gov.br/
- Ceará - https://mapacultural.secult.ce.gov.br/
- Espírito Santo - https://mapa.cultura.es.gov.br/
- Goiás - https://mapagoiano.cultura.go.gov.br/
- Maranhão - https://mapadacultura.ma.gov.br/
- Mato Grosso - https://mapas.mt.gov.br/
- Pará - https://mapacultural.pa.gov.br/
- Pernambuco - https://www.mapacultural.pe.gov.br/
- Paraíba - https://mapacultural.pb.gov.br/
- Piauí - https://www.mapadacultura.pi.gov.br/
- Tocantins - https://mapadacultura.secult.to.gov.br/

### Instalações municipais
- Aparecida de Goiânia - https://portaldacultura.aparecida.go.gov.br/
- Apucarana - https://cultura.apucarana.pr.gov.br/
- Aracaju - http://mapa.cultura.aracaju.se.gov.br/
- Belo Horizonte - https://mapaculturalbh.pbh.gov.br/
- Bento Gonçalvez - http://mapacultural.bentogoncalves.rs.gov.br/
- Campo Mourão - https://mapas.campomourao.pr.gov.br/
- Campos dos Goytacazes - https://mapasculturais.campos.rj.gov.br/
- Camaçari - https://mapacultural.camacari.ba.gov.br/
- Campinas - https://mapacultural.campinas.sp.gov.br/
- Chorozinho - https://mapacultural.chorozinho.ce.gov.br/
- Gravataí - https://mapacultural.gravatai.rs.gov.br/
- Iguatu - http://mapacultural.iguatu.ce.gov.br/
- João Pessoa - https://jpcultura.joaopessoa.pb.gov.br/
- Lagoa Santa - https://mapacultural.lagoasanta.mg.gov.br/
- Londrina - https://londrinacultura.londrina.pr.gov.br/
- Maringá - https://maringacultura.maringa.pr.gov.br/
- Mauá - https://mapacultural.maua.sp.gov.br/
- Natal - https://mapacultural.natal.rn.gov.br/
- Nova Lima - https://mapacultural.novalima.mg.gov.br/
- Parauapebas - https://mapacultural.parauapebas.pa.gov.br/
- Petrolina - https://mapacultural.petrolina.pe.gov.br/
- Ribeirão das Neves - http://mapaculturaneves.com.br/
- Santa Luzia - http://mapacultural.santaluzia.mg.gov.br/
- Santo André - https://culturaz.santoandre.sp.gov.br/
- São Gonçalo do Amarante - https://mapacultural.saogoncalodoamarante.ce.gov.br/
- São Bernardo - https://mapacultural.saobernardo.sp.gov.br/
- Sarandi - https://cultura.sarandi.pr.gov.br/
- Toledo/PR - https://cultura.toledo.pr.gov.br/

### Outras instalações
- Floresta Ativista - https://rede.florestaativista.org/
- AMFRIMapa Cultural CIM-AMFRI / SC - https://mapacultural.cim-amfri.sc.gov.br/
- Mapa Cultural AGIMOS - UFPel - https://mapacultural.ufpel.edu.br/
- Mapa da Inovação do ES - https://mapa.inovacao.es.gov.br/
- Balaio Cultural UFPR - https://mapadacultura.ufpr.br/
- Periferia Viva - Ministério das Cidades - https://iniciativas-mapadasperiferias.cidades.gov.br/

## Sobre a aplicação
Mapas Culturais é uma aplicação web server-side baseada em linguagem PHP e banco de dados Postgres, entre outras tecnologias e componentes, que propicia um ambiente virtual para mapeamento, divulgação e gestão de ativos culturais. 

## Projetos correlatos
* [Mapas Cuturais Base Project](https://github.com/hacklabr/mapasculturais-app) - Repositório de projeto base para novas instalações.
* [Multiple Local Auth](https://github.com/mapasculturais/mapasculturais-MultipleLocalAuth) - Plugin de autenticação local + oauth.
* [Mapas SDK](https://github.com/centroculturalsp/MapasSDK)

## Instalação
A maneira mais simples e segura para instalar o Mapas Culturais é utilizando o [Mapas Culturais Base Project](https://github.com/mapasculturais/mapasculturais-base-project) como base para a criação de um repositório próprio para o seu projeto, que reunirá o tema, os plugins e as configurações da aplicação. O Mapas Culturais Base Project utiliza o Docker e o Docker Composer para rodar a aplicação, facilitando os processos de deploy e de atualizaçao.

- [Instalação utilizando o Base Project ](https://github.com/mapasculturais/mapasculturais-base-project#readme) - **RECOMENDADO**
## Documentação

Uma [nova documentação](https://mapasculturais.gitbook.io/bem-vindo-a-a-documentacao-do-mapas/) está sendo escrita no gitbook, organizada em três seções:
- [Documentação para usuários](https://mapasculturais.gitbook.io/documentacao-para-usuarios/)
- [Documentação para desenvolvedores](https://mapasculturais.gitbook.io/documentacao-para-desenvolvedores/formacao-para-desenvolvedores/)
- [Documentação para devops](https://mapasculturais.gitbook.io/documentacao-para-devops/instalacao/)

## Documentação Legada

A documentação pode ser navegada no endereço (http://docs.mapasculturais.org)

Toda documentação da aplicação está na pasta [documentation](documentation). Principais referências: 
- [API](http://docs.mapasculturais.org/apidoc/index.html?doctype=api)
- [API - exemplos](documentation/docs/mc_config_api.md)
- [Como contribuir](documentation/docs/mc_developer_contribute.md)
- [Importação de arquivos de dados geoespaciais (Shapefiles)](documentation/docs/mc_deploy_shapefiles.md)
- [Deploy diretamente no sistema operacional](https://docs.mapasculturais.org/mc_deploy/) - **NÃO RECOMENDADO**

### [Software] Requisitos para Instalação
Lista dos principais softwares que compõe e aplicação. Maiores detalhes, ver documentação de [instalação](documentation/docs/mc_deploy.md) ou [guia do desenvolvedor](documentation/docs/mc_developer_guide.md). 

- [PHP = 8.3](http://php.net)
- [Composer](https://getcomposer.org/)
- [PostgreSQL >= 14](http://www.postgresql.org/)
- [Postgis >= 2.2](http://postgis.net)
- [Node.JS >= 20](https://nodejs.org/en/)

## Hardware

As estimativas abaixo podem variar de acordo com a velocidade dos cores, velocidade do disco, entre outros fatores, por isso recomenda-se que o sysadmin monitore o sistema para ajustar os recursos de acordo com a demanda.

Sobre o armazenamento deve-se considerar que a tendência é que o uso de espaço em disco cresça constantemente a medida que novos editais vão sendo cadastrados. A quantidade indicada nas tabelas abaixo são uma estimativa para o primeiro ano de uso da plataforma, mas deve ser monitorado e ajustado de acordo com a demanda.

### Instalações de pequeno porte (até 2.000 usuários ativos)

<table><thead><tr><th> </th><th width="150">CPUs</th><th width="150">RAM</th><th>Armazenamento</th></tr></thead><tbody><tr><td>mínimo</td><td>2</td><td>2GB</td><td>25GB SSD</td></tr><tr><td>recomendado</td><td>4</td><td>4GB</td><td>50GB SSD</td></tr><tr><td>durante grandes editais</td><td>6</td><td>6GB</td><td>50GB SSD</td></tr></tbody></table>

### Instalações de médio porte (entre 2.000 e 10.000 usuários ativos)

<table><thead><tr><th> </th><th width="150">CPUs</th><th width="150">RAM</th><th>Armazenamento</th></tr></thead><tbody><tr><td>mínimo</td><td>4</td><td>4GB</td><td>50GB SSD</td></tr><tr><td>recomendado</td><td>6</td><td>6GB</td><td>75GB SSD</td></tr><tr><td>durante grandes editais</td><td>8</td><td>8GB</td><td>75GB SSD</td></tr></tbody></table>

### Instalações de grante porte (acima de 10.000 usuários ativos)

<table><thead><tr><th> </th><th width="150">CPUs</th><th width="150">RAM</th><th>Armazenamento</th></tr></thead><tbody><tr><td>mínimo</td><td>6</td><td>6GB</td><td>150GB SSD</td></tr><tr><td>recomendado</td><td>8</td><td>8GB</td><td>250GB SSD</td></tr><tr><td>durante grandes editais</td><td>16</td><td>16GB</td><td>250GB SSD</td></tr></tbody></table>

Vale lembrar que os requisitos de hardware podem variar de acordo com a latência da rede, velocidade dos cores dos cpus, uso de proxies, entre outros fatores. Recomendamos aos sysadmin da rede em que a aplicação será instalada um monitoramento de tráfego e uso durante o período de 6 meses a 1 ano para avaliação de cenário de uso. 

## Como criar um subsite

Para criar um novo subsite na instação, você pode executar comandos PHP diretamente no container usando o `psysh` (shell interativo do PHP).

### Acesso ao psysh

```bash
kubectl exec -n <namespace> <pod-name> -- php /var/www/src/tools/psysh.php
```

### Criar um subsite via psysh

Execute os seguintes comandos no psysh:

```php
// 1. Obter o app e o usuário admin
$app = MapasCulturais\App::i();
$em = $app->em;

// 2. Obter o agente do usuário (necessário como owner do subsite)
$agent = $app->repo("Agent")->find(1); // Usuário ID 1 geralmente é o admin

// 3. Criar nova instância de Subsite
$subsite = new \MapasCulturais\Entities\Subsite();
$subsite->name = 'Nome do Subsite';          // Nome de exibição
$subsite->url = 'funarte-mapas-dev';         // URL do subsite
$subsite->aliasUrl = 'funarte-mapas-dev';     // Alias URL
$subsite->namespace = 'Funarte';             // Namespace do tema

// 4. Definir o owner do subsite (via reflection)
$reflection = new ReflectionClass($subsite);
$property = $reflection->getProperty("owner");
$property->setAccessible(true);
$property->setValue($subsite, $agent);

$property = $reflection->getProperty("_ownerId");
$property->setAccessible(true);
$property->setValue($subsite, $agent->id);

// 5. Salvar no banco de dados
$app->disableAccessControl();
$em->persist($subsite);
$em->flush();
$app->enableAccessControl();

echo "Subsite criado com ID: " . $subsite->id;
```

### Exemplo: Criar subsite "Funarte Dev"

```php
// Obter agente do usuário
$agent = $app->repo("Agent")->find(1);

// Criar subsite
$subsite = new \MapasCulturais\Entities\Subsite();
$subsite->name = 'Funarte Dev';
$subsite->url = 'funarte-mapas-dev.mapas.tec.br';
$subsite->aliasUrl = 'funarte-mapas-dev';
$subsite->namespace = 'Funarte';

// Definir owner
$reflection = new ReflectionClass($subsite);
$property = $reflection->getProperty("owner");
$property->setAccessible(true);
$property->setValue($subsite, $agent);

$property = $reflection->getProperty("_ownerId");
$property->setAccessible(true);
$property->setValue($subsite, $agent->id);

// Salvar
$app->disableAccessControl();
$em->persist($subsite);
$em->flush();
$app->enableAccessControl();

echo "Subsite ID: " . $subsite->id;
```

### Adicionar permissões de admin ao subsite

Após criar o subsite, adicione a role de admin para o usuário:

```php
$user = $app->repo("User")->find(1);
$app->disableAccessControl();
$user->addRole("admin", $subsite->id);
$em->flush();
$app->enableAccessControl();
```

### Acessar o subsite

Depois de criado, o subsite será acessível em:
- `https://<url-do-subsite>/`
- `https://<alias-url-do-subsite>/`

Exemplo: `https://funarte-mapas-dev.mapas.tec.br/`

### Atualizar subsite existente

Se precisar atualizar um subsite existente:

```php
// Obter o subsite
$subsite = $app->repo("Subsite")->find(<SUBSITE_ID>);

// Atualizar valores
$subsite->name = 'Novo Nome';
$subsite->url = 'nova-url';
$subsite->aliasUrl = 'novo-alias';

// Salvar
$app->disableAccessControl();
$em->flush();
$app->enableAccessControl();
```

## Canais de comunicação

* Jitsi: https://meet.jit.si/MapasCulturais
* Canal do Telegram: [![Join the chat at https://t.me/RedeMapas](https://patrolavia.github.io/telegram-badge/chat.png)](https://t.me/RedeMapas)

### Regras do grupo do Telegram Mapas Culturais

* Antes de postar, releia e analise se o conteúdo:
Ofenda as pessoas do grupo;
Se o conteúdo tem procedência. Só poste se você pode defender a autenticidade do assunto, consulte fontes seguras;
Seja propositivo, não faça críticas desnecessárias;
Se precisar chamar a atenção de alguém, faça com mensagens privadas, direto para os responsáveis;
Evite “ser chato”;
Qualquer membro que se sentir ofendido por outro, poderá informar aos admins para análise do conteúdo
Não faça publicidade e propagandas fora do tema Preferencialmente mande mensagem, mas audio não está proibido Nada de correntes: Repassar correntes é de muito mau gosto, até mesmo aquelas de “utilidade pública”. **Evite *

#### Atitutdes proibidas, com possibilidade de ser removido do grupo:
Fazer propaganda, sem a permissão dos moderadores;
Envio de links de grupos sem a prévia autorização dos moderadores;
Postar assuntos que não sejam pertinentes ao propósito do grupo;
Postar mensagens com conteúdo de brincadeiras, piadas, racismo, pornografia, correntes, ativismo político, homofóbicos, sexualmente explícitos e abusivos;
Link externo para páginas inadequadas de forma evitar SPAM;
Debates políticos com propósitos partidários. 
  
## Licença de uso e desenvolvimento

Mapas Culturais é um software livre licenciado com [GPLv3](http://gplv3.fsf.org). 


